<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misaka Cipher - Nexus Portal</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&family=Fira+Code&display=swap"
        rel="stylesheet">

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/style.css?v=2">
</head>

<body>
    <!-- Header with Tabs and Status -->
    <header class="header">
        <div class="header-left">
            <h1 class="logo">MISAKA CIPHER</h1>
            <div class="main-tabs">
                <button class="main-tab active" data-maintab="chat">Chat</button>
                <button class="main-tab" data-maintab="files">Files</button>
                <button class="main-tab" data-maintab="tools">Tools</button>
                <button class="main-tab" data-maintab="packages">Packages</button>
                <button class="main-tab" data-maintab="memory">Memory</button>
            </div>
        </div>
        <div class="header-right">
            <div class="compact-status" id="compact-status">
                <span title="Nexus Core">Nexus: <strong id="nexus-status">--</strong></span>
                <span class="status-divider">|</span>
                <span title="Active Agents">Agents: <strong id="agents-count">0</strong></span>
                <span class="status-divider">|</span>
                <span title="Registered Tools">Tools: <strong id="tools-count">--</strong></span>
                <span class="status-divider">|</span>
                <span title="Output Files">Files: <strong id="files-count">--</strong></span>
            </div>
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-container">
        <!-- Chat Tab (4-column layout with threads) -->
        <div class="main-tab-panel active" id="chat-panel">
            <div class="four-column-layout">
                <!-- Far Left: Thread List -->
                <div class="column threads-column">
                    <div class="column-header">
                        <h2>Threads</h2>
                        <button id="new-thread-button" class="new-thread-button" title="New Thread">+</button>
                    </div>
                    <div class="threads-list" id="threads-list">
                        <!-- Thread items will be added here -->
                        <div class="thread-item active" data-thread-id="default">
                            <div class="thread-title">Main Thread</div>
                            <div class="thread-meta">
                                <span class="thread-task-count">0 tasks</span>
                                <span class="thread-status">idle</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Left: System Logs -->
                <div class="column logs-column">
                    <div class="column-header">
                        <h2>System Logs</h2>
                    </div>
                    <div class="logs-container" id="logs-container">
                        <!-- Logs will stream here -->
                    </div>
                </div>

                <!-- Center: Chat Interface -->
                <div class="column chat-column">
                    <div class="column-header">
                        <h2 id="active-thread-title">Main Thread</h2>
                        <div class="voice-button" id="voice-button" title="Voice Input">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </div>
                    </div>

                    <div class="chat-messages" id="chat-messages">
                        <div class="message system-message">
                            <div class="message-content">
                                <strong>System:</strong> Misaka Cipher Nexus Portal initialized.
                                Ask me anything - I'll autonomously coordinate agents, forge tools, and query your
                                knowledge base.
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-container">
                        <input type="text" id="chat-input" class="chat-input"
                            placeholder="Ask me anything... (e.g., 'Analyze TSLA stock outlook')" autocomplete="off" />
                        <button id="send-button" class="send-button">Send</button>
                    </div>
                </div>

                <!-- Right: Active Agents -->
                <div class="column agents-column">
                    <div class="column-header">
                        <h2>Active Agents</h2>
                    </div>
                    <div class="agents-list" id="agents-list">
                        <div class="no-agents">No active agents</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Files Tab -->
        <div class="main-tab-panel" id="files-panel">
            <div class="panel-header">
                <h2>Workspace Files</h2>
                <div class="file-filters">
                    <select id="domain-filter" class="filter-select">
                        <option value="">All Domains</option>
                        <option value="Finance">Finance</option>
                        <option value="System">System</option>
                        <option value="Data">Data</option>
                        <option value="Code">Code</option>
                        <option value="Audio">Audio</option>
                        <option value="General">General</option>
                    </select>
                    <select id="type-filter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="pdf">PDF</option>
                        <option value="txt">Text</option>
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                        <option value="html">HTML</option>
                    </select>
                    <button id="refresh-files" class="refresh-button">ðŸ”„ Refresh</button>
                </div>
            </div>
            <div class="files-grid" id="files-grid">
                <p class="placeholder-text">No files yet. Ask Misaka to create reports, analysis, or other outputs!</p>
            </div>
        </div>

        <!-- Tools Tab -->
        <div class="main-tab-panel" id="tools-panel">
            <div class="panel-header">
                <h2>Tool Registry</h2>
                <button id="forge-tool-button" class="forge-button">+ Forge New Tool</button>
            </div>
            <div class="tools-grid" id="tools-grid">
                <p class="placeholder-text">Loading tools...</p>
            </div>
        </div>

        <!-- Packages Tab -->
        <div class="main-tab-panel" id="packages-panel">
            <div class="panel-header">
                <h2>Package Management</h2>
            </div>

            <!-- Package Sub-tabs -->
            <div class="package-tabs">
                <button class="package-tab active" data-packagetab="pending">Pending <span id="pending-count"
                        class="count-badge">0</span></button>
                <button class="package-tab" data-packagetab="installed">Installed <span id="installed-count"
                        class="count-badge">0</span></button>
                <button class="package-tab" data-packagetab="denied">Denied <span id="denied-count"
                        class="count-badge">0</span></button>
            </div>

            <!-- Pending Packages -->
            <div class="package-tab-panel active" id="pending-packages">
                <div id="pending-packages-list" class="packages-list">
                    <p class="placeholder-text">No pending package requests</p>
                </div>
            </div>

            <!-- Installed Packages -->
            <div class="package-tab-panel" id="installed-packages">
                <div id="installed-packages-list" class="packages-list">
                    <p class="placeholder-text">Loading installed packages...</p>
                </div>
            </div>

            <!-- Denied Packages -->
            <div class="package-tab-panel" id="denied-packages">
                <div id="denied-packages-list" class="packages-list">
                    <p class="placeholder-text">No denied packages</p>
                </div>
            </div>
        </div>

        <!-- Memory Tab -->
        <div class="main-tab-panel" id="memory-panel">
            <div class="panel-header">
                <h2>Episodic Memory Search</h2>
            </div>
            <div class="search-bar">
                <input type="text" id="memory-search" class="search-input" placeholder="Search episodic memory..." />
                <select id="memory-domain-filter" class="filter-select">
                    <option value="">All Domains</option>
                    <option value="Finance">Finance</option>
                    <option value="System">System</option>
                    <option value="Data">Data</option>
                    <option value="Code">Code</option>
                </select>
                <button id="memory-search-button" class="search-button">Search</button>
            </div>
            <div class="memory-results" id="memory-results">
                <p class="placeholder-text">Search your knowledge base...</p>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/marked@latest/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/static/threads.js?v=1"></script>
    <script src="/static/app.js?v=2"></script>
</body>

</html>