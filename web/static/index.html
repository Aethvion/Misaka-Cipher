<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Misaka Cipher - Nexus Portal</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Inter:wght@400;600&family=Fira+Code&display=swap"
        rel="stylesheet">

    <!-- Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/static/style.css?v=2">
</head>

<body>
    <!-- Header with Tabs and Status -->
    <header class="header">
        <div class="header-left">
            <h1 class="logo">MISAKA CIPHER</h1>
            <div class="main-tabs">
                <button class="main-tab active" data-maintab="chat">Chat</button>
                <button class="main-tab" data-maintab="files">Files</button>
                <button class="main-tab" data-maintab="tools">Tools</button>
                <button class="main-tab" data-maintab="packages">Packages</button>
                <button class="main-tab" data-maintab="memory">Memory</button>
                <button class="main-tab" data-maintab="settings">Settings</button>
            </div>
        </div>
        <div class="header-right">
            <div class="compact-status" id="compact-status">
                <span title="Nexus Core">Nexus: <strong id="nexus-status">--</strong></span>
                <span class="status-divider">|</span>
                <span title="Active Agents">Agents: <strong id="agents-count">0</strong></span>
                <span class="status-divider">|</span>
                <span title="Registered Tools">Tools: <strong id="tools-count">--</strong></span>
                <span class="status-divider">|</span>
                <span title="Output Files">Files: <strong id="files-count">--</strong></span>
            </div>
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text">Connecting...</span>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-container">
        <!-- Chat Tab (4-column layout with threads) -->
        <div class="main-tab-panel active" id="chat-panel">
            <div class="four-column-layout">
                <!-- Far Left: Thread List -->
                <div class="column threads-column">
                    <div class="column-header">
                        <h2>Threads</h2>
                        <button id="new-thread-button" class="new-thread-button" title="New Thread">+</button>
                    </div>
                    <div class="threads-list" id="threads-list">
                        <!-- Thread items will be dynamically added here by JavaScript -->
                    </div>
                </div>

                <!-- Left: System Logs -->
                <div class="column logs-column">
                    <div class="column-header">
                        <h2>System Logs</h2>
                    </div>
                    <div class="logs-container" id="logs-container">
                        <!-- Logs will stream here -->
                    </div>
                </div>

                <!-- Center: Chat Interface -->
                <div class="column chat-column">
                    <div class="column-header">
                        <h2 id="active-thread-title">Main Thread</h2>
                        <div class="voice-button" id="voice-button" title="Voice Input">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z" />
                                <path
                                    d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z" />
                            </svg>
                        </div>
                    </div>

                    <div class="chat-messages" id="chat-messages">
                        <div class="message system-message">
                            <div class="message-content">
                                <strong>System:</strong> Misaka Cipher Nexus Portal initialized.
                                Ask me anything - I'll autonomously coordinate agents, forge tools, and query your
                                knowledge base.
                            </div>
                        </div>
                    </div>

                    <div class="chat-input-container">
                        <input type="text" id="chat-input" class="chat-input"
                            placeholder="Ask me anything... (e.g., 'Analyze TSLA stock outlook')" autocomplete="off" />
                        <button id="send-button" class="send-button">Send</button>
                    </div>
                </div>

                <!-- Right: Active Agents -->
                <div class="column agents-column">
                    <div class="column-header">
                        <h2>Active Agents</h2>
                    </div>
                    <div class="agents-list" id="agents-list">
                        <div class="no-agents">No active agents</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Files Tab -->
        <div class="main-tab-panel" id="files-panel">
            <div class="panel-header">
                <h2>Workspace Files</h2>
                <div class="file-filters">
                    <select id="domain-filter" class="filter-select">
                        <option value="">All Domains</option>
                        <option value="Finance">Finance</option>
                        <option value="System">System</option>
                        <option value="Data">Data</option>
                        <option value="Code">Code</option>
                        <option value="Audio">Audio</option>
                        <option value="General">General</option>
                    </select>
                    <select id="type-filter" class="filter-select">
                        <option value="">All Types</option>
                        <option value="pdf">PDF</option>
                        <option value="txt">Text</option>
                        <option value="csv">CSV</option>
                        <option value="json">JSON</option>
                        <option value="html">HTML</option>
                    </select>
                    <button id="refresh-files" class="refresh-button">ðŸ”„ Refresh</button>
                </div>
            </div>
            <div class="files-grid" id="files-grid">
                <p class="placeholder-text">No files yet. Ask Misaka to create reports, analysis, or other outputs!</p>
            </div>
        </div>

        <!-- Tools Tab -->
        <div class="main-tab-panel" id="tools-panel">
            <div class="panel-header">
                <h2>Tool Registry</h2>
                <button id="forge-tool-button" class="forge-button">+ Forge New Tool</button>
            </div>
            <div class="tools-grid" id="tools-grid">
                <p class="placeholder-text">Loading tools...</p>
            </div>
        </div>

        <!-- Packages Tab -->
        <div class="main-tab-panel" id="packages-panel">
            <div class="panel-header">
                <h2>Package Management</h2>
                <div class="panel-controls">
                    <input type="text" id="package-search" placeholder="Search packages..." class="search-input">
                    <select id="package-status-filter" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="pending">Pending</option>
                        <option value="installed">Installed</option>
                        <option value="approved">Approved</option>
                        <option value="denied">Denied</option>
                        <option value="failed">Failed</option>
                    </select>
                    <div class="toggle-control"
                        style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); font-size: 0.9rem;">
                        <input type="checkbox" id="hide-system-packages">
                        <label for="hide-system-packages">Hide System Pkgs</label>
                    </div>
                    <button id="sync-packages-btn" class="action-btn secondary" title="Sync with installed packages">
                        <i class="fas fa-sync"></i> Sync
                    </button>
                    <button id="refresh-packages-btn" class="action-btn secondary" title="Refresh list">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>

            <div class="packages-table-container" style="overflow-x: auto;">
                <table class="data-table" id="packages-table"
                    style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="text-align: left; border-bottom: 2px solid var(--border);">
                            <th class="sortable" data-sort="name" style="padding: 10px; cursor: pointer;">Package â†•</th>
                            <th class="sortable" data-sort="status" style="padding: 10px; cursor: pointer;">Status â†•
                            </th>
                            <th class="sortable" data-sort="usage" style="padding: 10px; cursor: pointer;">Usage â†•</th>
                            <th class="sortable" data-sort="safety" style="padding: 10px; cursor: pointer;">Safety â†•
                            </th>
                            <th class="sortable" data-sort="updated" style="padding: 10px; cursor: pointer;">Updated â†•
                            </th>
                            <th style="padding: 10px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="packages-table-body">
                        <!-- Rows injected by JS -->
                        <tr>
                            <td colspan="6" class="placeholder-text" style="text-align: center; padding: 20px;">Loading
                                packages...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Memory Tab -->
        <div class="main-tab-panel" id="memory-panel">
            <div class="panel-header">
                <h2>Episodic Memory Search</h2>
            </div>
            <div class="search-bar">
                <input type="text" id="memory-search" class="search-input" placeholder="Search episodic memory..." />
                <select id="memory-domain-filter" class="filter-select">
                    <option value="">All Domains</option>
                    <option value="Finance">Finance</option>
                    <option value="System">System</option>
                    <option value="Data">Data</option>
                    <option value="Code">Code</option>
                </select>
                <button id="memory-search-button" class="search-button">Search</button>
            </div>
            <div class="memory-results" id="memory-results">
                <p class="placeholder-text">Search your knowledge base...</p>
            </div>
        </div>
    </main>

    <!-- Settings Tab -->
    <div class="main-tab-panel" id="settings-panel">
        <div class="panel-header" style="padding: 1.5rem; border-bottom: 1px solid var(--border);">
            <h2>System Settings</h2>
        </div>
        <div class="settings-container">
            <div class="setting-group">
                <h3>Validation & Context</h3>

                <div class="setting-item">
                    <label class="switch">
                        <input type="checkbox" id="setting-strict-mode">
                        <span class="slider round"></span>
                    </label>
                    <div class="setting-label">
                        <strong>Strict Domain Validation</strong>
                        <span>
                            Enforce Aethvion naming conventions (Domain_Action_Object) and restrict usage to approved
                            domains only.
                            Disable this to allow creating agents with custom domains (e.g. Story_Write_Plot).
                        </span>
                    </div>
                </div>

                <div class="setting-item">
                    <label class="switch">
                        <input type="checkbox" id="setting-agents-panel" checked>
                        <span class="slider round"></span>
                    </label>
                    <div class="setting-label">
                        <strong>Show Active Agents Panel</strong>
                        <span>Toggle visibility of the right-side agents column in Chat view.</span>
                    </div>
                </div>
            </div>

            <div class="setting-group">
                <h3>Package Management</h3>
                <div class="setting-item">
                    <label class="switch">
                        <input type="checkbox" id="setting-hide-system-pkgs">
                        <span class="slider round"></span>
                    </label>
                    <div class="setting-label">
                        <strong>Hide System Packages</strong>
                        <span>Filter out internal system packages from the packages list view.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </main>

    <!-- Scripts -->
    <script src="/static/lib/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="/static/threads.js?v=4"></script>
    <script src="/static/app.js?v=5"></script>
</body>

</html>